var Demo={init:function(){return Demo.info={},Demo.el={blocks:$("#blocks"),canvas:$("#canvas")[0],size:$("#size"),sort:$("#sort"),color:$("#color"),ratio:$("#ratio"),nofit:$("#nofit")},Demo.el.canvas.getContext?(Demo.el.draw=Demo.el.canvas.getContext("2d"),Demo.el.blocks.change(Demo.run),Demo.el.size.change(Demo.run),Demo.el.sort.change(Demo.run),Demo.el.color.change(Demo.run),Demo.el.blocks.keypress(function(a){13===a.which&&Demo.run()}),void Demo.run()):!1},run:function(){Demo.info={};var a=Demo.blocks.deserialize(Demo.el.blocks.val()),b=Demo.packer();Demo.sort.now(a),b.fit(a),Demo.canvas.reset(b.root.w,b.root.h),Demo.canvas.blocks(a),Demo.canvas.boundary(b.root),Demo.report(a,b.root.w,b.root.h)},packer:function(){var a=Demo.el.size.val();if("elastic"===a)return new GrowingPacker;var b=a.split("x");return new Packer(parseInt(b[0]),parseInt(b[1]))},report:function(a,b,c){var d,e,f=0,g=[],h=a.length;for(e=0;h>e;e++)d=a[e],d.fit?f+=d.area:g.push(""+d.w+"x"+d.h);Demo.el.ratio.text(Math.round(100*f/(b*c))),Demo.el.nofit.html("Nu au incaput ("+g.length+")"),Demo.info={all:a.length,nofit:g.length,fit:a.length-g.length}},sort:{random:function(){return Math.random()-.5},w:function(a,b){return b.w-a.w},h:function(a,b){return b.h-a.h},a:function(a,b){return b.area-a.area},max:function(a,b){return Math.max(b.w,b.h)-Math.max(a.w,a.h)},min:function(a,b){return Math.min(b.w,b.h)-Math.min(a.w,a.h)},height:function(a,b){return Demo.sort.msort(a,b,["h","w"])},width:function(a,b){return Demo.sort.msort(a,b,["w","h"])},area:function(a,b){return Demo.sort.msort(a,b,["a","h","w"])},maxside:function(a,b){return Demo.sort.msort(a,b,["max","min","h","w"])},msort:function(a,b,c){var d,e;for(e=0;e<c.length;e++)if(d=Demo.sort[c[e]](a,b),0!==d)return d;return 0},now:function(a){var b=Demo.el.sort.val();"none"!==b&&a.sort(Demo.sort[b])}},canvas:{reset:function(a,b){Demo.el.canvas.width=a+1,Demo.el.canvas.height=b+1,Demo.el.draw.clearRect(0,0,Demo.el.canvas.width,Demo.el.canvas.height)},rect:function(a,b,c,d,e){Demo.el.draw.fillStyle=e,Demo.el.draw.fillRect(a+.5,b+.5,c,d)},stroke:function(a,b,c,d){Demo.el.draw.strokeRect(a+.5,b+.5,c,d)},blocks:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.fit&&Demo.canvas.rect(c.fit.x,c.fit.y,c.w,c.h,Demo.color(b))},boundary:function(a){a&&(Demo.canvas.stroke(a.x,a.y,a.w,a.h),Demo.canvas.boundary(a.down),Demo.canvas.boundary(a.right))}},blocks:{deserialize:function(a){var b,c,d,e=a.split("\n"),f=[];for(b=0;b<e.length;b++)d=e[b].split("x"),d.length>=2&&f.push({w:parseInt(d[0]),h:parseInt(d[1]),num:2===d.length?1:parseInt(d[2])});var g=[];for(b=0;b<f.length;b++)for(c=0;c<f[b].num;c++)g.push({w:f[b].w,h:f[b].h,area:f[b].w*f[b].h});return g},serialize:function(a){var b,c,d="";for(b=0;b<a.length;b++)c=a[b],d=d+c.w+"x"+c.h+(c.num>1?"x"+c.num:"")+"\n";return d}},colors:{pastel:["#FFF7A5","#FFA5E0","#A5B3FF","#BFFFA5","#FFCBA5"],basic:["silver","gray","red","maroon","yellow","olive","lime","green","aqua","teal","blue","navy","fuchsia","purple"],gray:["#111","#222","#333","#444","#555","#666","#777","#888","#999","#AAA","#BBB","#CCC","#DDD","#EEE"],vintage:["#EFD279","#95CBE9","#024769","#AFD775","#2C5700","#DE9D7F","#7F9DDE","#00572C","#75D7AF","#694702","#E9CB95","#79D2EF"],solarized:["#b58900","#cb4b16","#dc322f","#d33682","#6c71c4","#268bd2","#2aa198","#859900"],none:["transparent"]},color:function(a){var b=Demo.colors[Demo.el.color.val()];return b[a%b.length]}};$(Demo.init);